<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Analytics - Vendra CRM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/assets/css/vendra-theme.css" rel="stylesheet">
    <link href="/assets/css/dashboard.css" rel="stylesheet">
    <link href="/assets/css/mobile.css" rel="stylesheet">
    <link href="/assets/css/statistics-mobile.css" rel="stylesheet">
    <link href="/assets/css/bottom-nav.css" rel="stylesheet">
    <style>
        /* Enhanced Insight Cards */
        .insight-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            border: 1px solid #e3e8f0;
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            min-height: 70px;
            height: auto;
        }
        
        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .vip-card {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-color: #ffb74d;
        }
        
        .vip-card .insight-icon {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
        }
        
        .premium-card {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-color: #81c784;
        }
        
        .premium-card .insight-icon {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
        }
        
        .regular-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-color: #64b5f6;
        }
        
        .regular-card .insight-icon {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
        }
        
        .new-card {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
            border-color: #f06292;
        }
        
        .new-card .insight-icon {
            background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
            color: white;
        }
        
        .insight-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .insight-content {
            flex: 1;
            min-width: 0;
        }
        
        .insight-number {
            font-size: 20px;
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 2px;
            word-break: break-word;
        }
        
        .insight-label {
            font-size: 11px;
            font-weight: 500;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            line-height: 1.2;
        }
        
        .vip-card .insight-number { color: #f57c00; }
        .premium-card .insight-number { color: #388e3c; }
        .regular-card .insight-number { color: #1976d2; }
        .new-card .insight-number { color: #c2185b; }
        
        /* Compact chart container */
        .chart-container {
            position: relative;
            height: 200px;
            margin: 0;
        }
        
        /* Reduce card body padding for charts */
        .vendra-card-body.py-3 {
            padding-top: 1rem !important;
            padding-bottom: 1rem !important;
        }
        
        /* Modern KPI Cards */
        .modern-kpi-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e3e8f0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 120px;
            height: auto;
            display: flex;
            align-items: center;
        }
        
        .modern-kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.1);
        }
        
        .modern-kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--card-color) 0%, var(--card-color-light) 100%);
        }
        
        .revenue-card {
            --card-color: #28a745;
            --card-color-light: #34ce57;
        }
        
        .customers-card {
            --card-color: #007bff;
            --card-color-light: #4dabf7;
        }
        
        .orders-card {
            --card-color: #ffc107;
            --card-color-light: #ffcd39;
        }
        
        .average-card {
            --card-color: #17a2b8;
            --card-color-light: #3bc9db;
        }
        
        .kpi-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-right: 16px;
            flex-shrink: 0;
            background: linear-gradient(135deg, var(--card-color) 0%, var(--card-color-light) 100%);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        
        .kpi-content {
            flex: 1;
        }
        
        .kpi-number {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            line-height: 1.1;
            margin-bottom: 4px;
            word-break: break-word;
        }
        
        .kpi-label {
            font-size: 12px;
            font-weight: 500;
            color: #718096;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            line-height: 1.2;
        }
        
        .kpi-trend {
            font-size: 12px;
            font-weight: 600;
            color: #28a745;
            display: flex;
            align-items: center;
            line-height: 1.2;
        }
        
        .kpi-trend i {
            margin-right: 4px;
            font-size: 12px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .modern-kpi-card {
                height: 120px;
                padding: 20px;
            }
            
            .kpi-icon {
                width: 56px;
                height: 56px;
                font-size: 20px;
                margin-right: 16px;
            }
            
            .kpi-number {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Vendra Navbar Component -->
    <div id="navbar-container"></div>

    <!-- Sidebar will be loaded by sidebar.js -->

    <!-- Main Content -->
    <div class="main-content">
        <!-- Mobile Page Header -->
        <div class="page-header d-md-none">
            <h1 class="page-title">Analytics</h1>
            <p class="page-subtitle">Insights dan metrik bisnis real-time</p>
        </div>

        <!-- Desktop Analytics Header -->
        <div class="d-none d-md-flex justify-content-between align-items-center mb-4">
            <div>
                <h4 class="mb-1 vendra-primary">CRM Analytics Dashboard</h4>
                <p class="text-muted mb-0">Real-time business insights and customer relationship metrics</p>
            </div>
            <div class="d-flex gap-2">
                <button class="btn-vendra-outline btn-sm" onclick="statistics.refreshStats()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
        
        <!-- Mobile Section Title with Refresh -->
        <div class="section-title d-md-none">
            <span>Key Metrics</span>
            <button class="btn btn-outline-primary btn-refresh" onclick="statistics.refreshStats()">
                <i class="fas fa-sync-alt me-1"></i> Refresh
            </button>
        </div>

        <!-- Key Performance Indicators -->
        <div class="analytics-grid row g-3 mb-4">
            <div class="col-xl-3 col-md-6">
                <div class="analytics-card modern-kpi-card revenue-card">
                    <div class="analytics-icon kpi-icon" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="analytics-content kpi-content">
                        <div class="analytics-number kpi-number" id="totalRevenue">Rp 0</div>
                        <div class="analytics-label kpi-label">Total Revenue</div>
                        <div class="analytics-change kpi-trend positive" id="revenueTrend">
                            <i class="fas fa-arrow-up"></i> +12.5%
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="analytics-card modern-kpi-card customers-card">
                    <div class="analytics-icon kpi-icon" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="analytics-content kpi-content">
                        <div class="analytics-number kpi-number" id="totalCustomers">0</div>
                        <div class="analytics-label kpi-label">Active Customers</div>
                        <div class="analytics-change kpi-trend positive">
                            <i class="fas fa-user-plus"></i> +8.3%
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="analytics-card modern-kpi-card orders-card">
                    <div class="analytics-icon kpi-icon" style="background: linear-gradient(135deg, #fd7e14 0%, #e55a00 100%);">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="analytics-content kpi-content">
                        <div class="analytics-number kpi-number" id="totalTransactions">0</div>
                        <div class="analytics-label kpi-label">Total Orders</div>
                        <div class="analytics-change kpi-trend positive">
                            <i class="fas fa-chart-line"></i> +15.7%
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="analytics-card modern-kpi-card average-card">
                    <div class="analytics-icon kpi-icon" style="background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="analytics-content kpi-content">
                        <div class="analytics-number kpi-number" id="avgTransaction">Rp 0</div>
                        <div class="analytics-label kpi-label">Avg Order Value</div>
                        <div class="analytics-change kpi-trend positive">
                            <i class="fas fa-coins"></i> +5.2%
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chart & Quick Stats -->
        <div class="row g-4 mb-4">
            <div class="col-lg-8">
                <div class="vendra-card">
                    <div class="vendra-card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Revenue Trend Analysis</h6>
                            <div class="btn-group btn-group-sm" role="group">
                                <input type="radio" class="btn-check" name="revenueChart" id="daily" checked>
                                <label class="btn btn-outline-primary" for="daily">Daily</label>
                                <input type="radio" class="btn-check" name="revenueChart" id="weekly">
                                <label class="btn btn-outline-primary" for="weekly">Weekly</label>
                                <input type="radio" class="btn-check" name="revenueChart" id="monthly">
                                <label class="btn btn-outline-primary" for="monthly">Monthly</label>
                            </div>
                        </div>
                    </div>
                    <div class="vendra-card-body py-3">
                        <canvas id="revenueChart" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="vendra-card h-100">
                    <div class="vendra-card-header">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-chart-pie text-primary me-2"></i>
                            <h6 class="mb-0">Customer Insights</h6>
                        </div>
                    </div>
                    <div class="vendra-card-body">
                        <!-- Customer Segments Chart -->
                        <div class="mb-4">
                            <canvas id="customerSegmentChart" height="140"></canvas>
                        </div>
                        
                        <!-- Enhanced Customer Stats -->
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="insight-card vip-card">
                                    <div class="insight-icon">
                                        <i class="fas fa-crown"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-number" id="vipCustomers">0</div>
                                        <div class="insight-label">VIP</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="insight-card premium-card">
                                    <div class="insight-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-number" id="premiumCustomers">0</div>
                                        <div class="insight-label">Premium</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="insight-card regular-card">
                                    <div class="insight-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-number" id="regularCustomers">0</div>
                                        <div class="insight-label">Regular</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="insight-card new-card">
                                    <div class="insight-icon">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="insight-content">
                                        <div class="insight-number" id="newCustomers">0</div>
                                        <div class="insight-label">New</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Summary Stats -->
                        <div class="mt-4 pt-3 border-top">
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="fw-bold text-primary fs-5" id="totalCustomersInsight">0</div>
                                    <small class="text-muted">Total</small>
                                </div>
                                <div class="col-4">
                                    <div class="fw-bold text-success fs-5" id="activeCustomersInsight">0</div>
                                    <small class="text-muted">Active</small>
                                </div>
                                <div class="col-4">
                                    <div class="fw-bold text-info fs-5" id="growthRateInsight">+0%</div>
                                    <small class="text-muted">Growth</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compact Performance Overview -->
        <div class="row g-4 mb-4">
            <div class="col-lg-4">
                <div class="vendra-card">
                    <div class="vendra-card-header">
                        <h6 class="mb-0">Top Products</h6>
                    </div>
                    <div class="vendra-card-body p-3">
                        <div id="topProductsList" style="max-height: 300px; overflow-y: auto;">
                            <div class="d-flex justify-content-center py-3">
                                <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="vendra-card">
                    <div class="vendra-card-header">
                        <h6 class="mb-0">Top Customers</h6>
                    </div>
                    <div class="vendra-card-body p-3">
                        <div id="topCustomersList" style="max-height: 300px; overflow-y: auto;">
                            <div class="d-flex justify-content-center py-3">
                                <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="vendra-card">
                    <div class="vendra-card-header">
                        <h6 class="mb-0">Category Performance</h6>
                    </div>
                    <div class="vendra-card-body p-3">
                        <canvas id="categoryChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity (Compact) -->
        <div class="row g-4 mb-4">
            <div class="col-12">
                <div class="vendra-card">
                    <div class="vendra-card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Recent Activity</h6>
                            <a href="/dashboard" class="btn-vendra-outline btn-sm">View All</a>
                        </div>
                    </div>
                    <div class="vendra-card-body p-3">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="border-0">Customer</th>
                                        <th class="border-0">Product</th>
                                        <th class="border-0">Amount</th>
                                        <th class="border-0">Date</th>
                                        <th class="border-0">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTransactionsTable">
                                    <tr>
                                        <td colspan="5" class="text-center py-3">
                                            <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/assets/js/error-logger.js"></script>
    <script src="/assets/js/global-sidebar-fix.js"></script>
    <script src="/assets/js/navbar.js"></script>
    <script src="/assets/js/sidebar.js"></script>
    <script src="/assets/js/bottom-nav.js"></script>
    <script src="/assets/js/statistics.js"></script>

    <script>
        // Initialize navbar and sidebar components
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize navbar and sidebar components
            if (typeof VendraNavbar !== 'undefined') {
                window.vendraNavbar = new VendraNavbar();
            }
            
            if (typeof VendraSidebar !== 'undefined') {
                // Clean up any existing sidebar first
                if (window.vendraSidebar) {
                    window.vendraSidebar.removeExistingSidebars();
                }
                window.vendraSidebar = new VendraSidebar();
            }
            
            // Update sidebar active state after initialization
            setTimeout(() => {
                if (window.vendraSidebar) {
                    window.vendraSidebar.updateActiveState('statistics');
                }
                if (window.vendraBottomNav) {
                    window.vendraBottomNav.updateActiveState('statistics');
                }
            }, 100);
        });
    </script>

</body>
</html>
